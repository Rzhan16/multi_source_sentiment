<script>
    document.getElementById('f').addEventListener('submit', async e => {
      e.preventDefault();
      const sym = document.getElementById('sym').value.toUpperCase();
      const box = document.getElementById('out');
      box.innerHTML = '<p class="loading">Loadingâ€¦</p>';
    
      const res = await fetch('/analyze', {
        method: 'POST',
        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
        body: `stock_symbol=${sym}`
      });
    
      const data = await res.json();
    
      if (data.error || !data.sentiment.success) {
        box.innerHTML = `<p class="error">${data.error || data.sentiment.error}</p>`;
        return;
      }
    
      const sentimentList = Object.entries(data.sentiment.sources || {})
        .map(([source, score]) => `<li>${source}: ${(score * 100).toFixed(1)}%</li>`)
        .join('');
    
      box.innerHTML = `
        <h2>${sym}</h2>
        <p><strong>Average Sentiment:</strong> ${(data.sentiment.average_sentiment * 100).toFixed(1)}%</p>
        <ul>${sentimentList}</ul>
        <p><strong>Price:</strong> ${data.stock_data.data.currency}${data.stock_data.data.current_price}</p>
        ${data.plot_url ? `<img src="${data.plot_url}" width="600">` : '<p>No chart available</p>'}
      `;
    });
    </script>
    